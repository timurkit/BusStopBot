# BusStopBot
a small telegram bot connecting several bus stops into one image

*Для чего он?*

Из личных целей: отработать Python для парсинга, работы с базами данных и создания телеграм-бота.

Из утилитарных целей: для более оперативного проектирования привычного маршрута. В рамках одного транспортно-пересадочного узла или просто по пути может быть несколько разных маршрутов с разных остановок. Варианты из картографических сервисов часто не отражают полный спектр маршрутов, которые могут быть привычны человеку. А в рамках ТПУ бывают ситуации, когда можно уехать с нескольких остановок, находящихся на расстоянии друг от друга. В таких случаях полезно заранее сформировать пул\группу остановок, с которых можно одновременно снять время прибытия автобуса и сразу идти туда, где время прибытия автобуса оптимально.

*Какие подходы к решению?*

* В первую очередь нужно было найти акутальный сервис, позволяющий его без проблем парсить.

На выбор были Citymapper, Яндекс.Карты и Московский транспорт. Однако Citymapper очень редко обновляет маршрутную сеть, а Яндекс.Карты не любят, когда их парсят, таким образом выбор пал на Московский транспорт. Дополнительно само приложение позволяет отправлять ссылки на остановки.

*Как хранятся данные?*

Использовалась библиотека sqlite3, в базе данных хранятся id пользователя, пулы остановок и сами остановки.

* После парсинга встал вопрос о формировании изображения.

*Почему именно изображение?*

На выбор были текст, изображение и документ. Текст в телеграм-боте мог поплыть в зависимости от разрешения экрана, и несмотря на то что это самый легковесный и быстрый способ - он не подходил. Документы в свою очередь требуют больше времени на открытие, возможно у кого-то не будет приложения для открытия документа, из плюсов - возможно было бы использовать стили и дизайн. Однако проще всего оказалось работать сразу с изображениями.

Изображение формируется через *pandas.Dataframe* и библиотеку *dataframe-image*, что позволило сразу получить заранее обрезанное удовлетворительное по качеству и дизайну изображение.

![alt text](https://github.com/timurkit/BusStopBot/blob/main/merge_from_ofoct.jpg)


![alt text](https://github.com/timurkit/BusStopBot/blob/main/photo_2022-06-20_20-57-30.jpg)

![alt text](https://github.com/timurkit/BusStopBot/blob/main/Screenshot_12.png)

Из минусов реализации:
* Долгое время генерации изображения. На загруженном HP Laptop 15-bw0xx время достигало нескольких секунд. 
* Недостаточная асинхронность. Постоянно дорабатываются узкие места.
* Далеко не лучший дизайн. Для этого изучаю бибилиотеку Pillow и прорабатываю возможности отказа от *dataframe-image* в пользу работы с html и css и последующей конвертации в изображение.
